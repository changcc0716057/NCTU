cat sample-log-freebsd.txt | sed -e 's/Jan/01/1' -e 's/Feb/02/1' -e 's/Mar/03/1' -e 's/Apr/04/1' -e 's/May/05/1' -e 's/Jun/06/1' -e 's/Jul/07/1' -e 's/Aug/08/1' -e 's/Sep/09/1' -e 's/Oct/10/1' -e 's/Nov/11/1' -e 's/Dec/12/1' -e 's/ /-/1' -e 's/^.*/2021-&/1' -e 's/- /-0/1' | sed -e 's/ : .*COMMAND=/ used sudo to do `/' -e 's/[a-zA-z].*sudo.*:[ ]*//' -e 's/^.*used sudo.*/&` on &/' -e 's/.\{20\}//' -e 's/ [a-zA-z0-9]* used sudo.*//' -e '/used sudo/w audit_sudo.txt' | sed -r -e '/^.*PAM: Authentication.* for |^.*sys.*repeated /\!d' -e 's/^.*for |^.*repeated //' -e 's/ from//' | sed -e 'H;x' -e 's/^\(.*\)\n\(1 times\)/\1 \1/' -e 's/^\(.*\)\n\(2 times\)/\1 \1 \1/' -e 's/^\(.*\)\n\(.*[0-9]*\..*\)/\1/' -e '/^$/d' | sed -e 's/illegal user .*[ ]//' -e 's/ /\n/g' | sort | uniq -c | sed -e 's/   //1' -e 's/^.*/& failed to log in &/' -e 's/[0-9]* //1' -e 's/[a-zA-Z0-9\.]*$/times/' | sed -r -n -e '/[0-9]*\..*failed/w audit_ip.txt' -e '/^[0-9a-zA-Z]* failed/w audit_user.txt'
